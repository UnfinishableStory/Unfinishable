<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unfinishable ‚Äì The Infinite Story</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    /* Cooldown bar styling */
    #cooldown-container {
      display: none;
      width: 100%;
      background: #ddd;
      height: 20px;
      margin-bottom: 10px;
    }
    #cooldown-bar {
      height: 100%;
      width: 0%;
      background: #4caf50;
      transition: width 10s linear;
    }

    /* Glitch overlay styling */
    #glitch-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      color: lime;
      font-family: monospace;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
    }

    /* Message list styling */
    #message-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      background: #fff;
      margin-top: 20px;
    }

    #load-more {
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <!-- Form for input -->
  <form id="form" style="display:flex; flex-direction:column; gap:10px;">
    <input type="text" placeholder="Type something..." />
    <textarea placeholder="Or write more..."></textarea>
    <button type="submit">Submit</button>
  </form>

  <!-- Cooldown container -->
  <div id="cooldown-container">
    <div id="cooldown-bar"></div>
  </div>

  <!-- Glitch overlay -->
  <div id="glitch-overlay">
    <p>You triggered the anomaly. The loop begins.</p>
    <button id="escape-btn">Escape?</button>
  </div>

  <!-- Message list with pagination -->
  <ul id="message-list"></ul>
  <button id="load-more">Load More</button>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("form");
  const cooldownContainer = document.getElementById("cooldown-container");
  const cooldownBar = document.getElementById("cooldown-bar");
  const inputFields = document.querySelectorAll("input, textarea");
  const overlay = document.getElementById("glitch-overlay");
  const escapeBtn = document.getElementById("escape-btn");
  const messageList = document.getElementById("message-list");
  const loadMoreBtn = document.getElementById("load-more");

  // üìù Message storage
  let messages = [];
  let visibleCount = 20;

  // üìå Form submission logic with cooldown
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const text = form.querySelector("input").value || form.querySelector("textarea").value;
    if (text.trim() !== "") {
      messages.push({ text, createdAt: Date.now() });
      renderMessages();
    }

    // Cooldown sequence
    form.style.display = "none";
    cooldownContainer.style.display = "block";
    cooldownBar.style.width = "0%";

    setTimeout(() => { cooldownBar.style.width = "100%"; }, 50);
    setTimeout(() => {
      form.style.display = "flex";
      cooldownContainer.style.display = "none";
      cooldownBar.style.width = "0%";
    }, 10000);
  });

  // üìú Render messages with pagination
  function renderMessages() {
    const slice = messages.slice(-visibleCount);
    messageList.innerHTML = slice.map(m => `<li>${escapeHTML(m.text)}</li>`).join("");
    loadMoreBtn.style.display = messages.length > visibleCount ? "block" : "none";
  }

  // üîΩ Load more button
  loadMoreBtn.addEventListener("click", () => {
    visibleCount += 20;
    renderMessages();
  });

  // üîí Escape HTML utility
  function escapeHTML(str) {
    const div = document.createElement("div");
    div.textContent = str;
    return div.innerHTML;
  }

  // üß™ Glitch Easter Egg Logic
  inputFields.forEach(input => {
    input.addEventListener("input", (e) => {
      if (e.target.value.toLowerCase().includes("unfinishable")) {
        triggerGlitch();
      }
    });
  });

  escapeBtn.addEventListener("click", () => {
    console.warn("ACCESS DENIED. The loop continues.");
    showTrap();
  });

  function triggerGlitch() {
    overlay.style.display = "flex";
    console.warn("You triggered the anomaly. The loop begins.");
  }

  function showTrap() {
    // ‚ö†Ô∏è Preserve dark mode styling
    document.body.style.background = "#0d0d0d";
    document.body.innerHTML = `
      <div style="
        color: red;
        font-family: monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
      ">
        <p style="font-size: 1.4rem; margin-bottom: 20px;">There is no way out.</p>
        <p style="font-size: 1.4rem;">You're part of it now.</p>
      </div>
    `;
  }
});
</script>
</body>
</html>
